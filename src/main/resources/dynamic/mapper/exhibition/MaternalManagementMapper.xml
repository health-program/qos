<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paladin.qos.dynamic.mapper.exhibition.MaternalManagementMapper">

    <!--男性婚前检查-->
    <select id="getMalePremaritalCheckTotal" resultType="long">
        SELECT COUNT( 1 ) AS total
        FROM hjM_Hqjc  WHERE ihjyj = 0 AND bvisible = 1  AND dInDate >= #{ startTime }
       <if test="endTime != null">
           AND dInDate <![CDATA[<= ]]>#{ endTime }
      </if>
    </select>

    <select id="getMalePremaritalCheckNumber" resultType="long">
        SELECT COUNT( 1 ) AS total FROM hjM_Hqjc  WHERE ihjyj = 0 AND bvisible = 1
        <if test="startTime != null">
            AND dIndate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dIndate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>


    <!--女性婚前检查-->
    <select id="getFemalePremaritalCheckTotal" resultType="long">
        SELECT COUNT( 1 ) AS total
        FROM hjF_Hqjc  WHERE ihjyj = 0 AND bvisible = 1  AND dInDate >= #{ startTime }
        <if test="endTime != null">
            AND dInDate <![CDATA[<= ]]>#{ endTime }
        </if>
    </select>

    <select id="getFemalePremaritalCheckNumber" resultType="long">
        SELECT COUNT( 1 ) AS total FROM hjF_Hqjc  WHERE ihjyj = 0 AND bvisible = 1
        <if test="startTime != null">
            AND dIndate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dIndate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--孕前检查人次数-->
    <select id="getPrepregnancyCheckTotal" resultType="long">
         SELECT SUM
        ( total )
    FROM
        (
        SELECT COUNT
            ( 1 ) AS total
        FROM
            hjM_Hqjc
        WHERE
            ihjyj IN ( 1, 2 ) AND bvisible = 1 AND dInDate >= #{ startTime }
        <if test="endTime != null">
            AND dInDate <![CDATA[<= ]]>#{ endTime }
        </if>
             UNION ALL
        SELECT COUNT
            ( 1 ) AS total
        FROM
            hjF_Hqjc
        WHERE
            ihjyj IN ( 1, 2 ) AND bvisible = 1 AND dInDate >= #{ startTime }
        <if test="endTime != null">
            AND dInDate <![CDATA[<= ]]>#{ endTime }
        </if>
        ) c
    </select>

    <select id="getPrepregnancyCheckNumber" resultType="long">
        SELECT SUM
        ( total )
        FROM
        (
        SELECT COUNT
        ( 1 ) AS total
        FROM
        hjM_Hqjc
        WHERE
        ihjyj IN ( 1, 2 ) AND bvisible = 1
        <if test="startTime != null">
            AND dIndate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dIndate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
        UNION ALL
        SELECT COUNT
        ( 1 ) AS total
        FROM
        hjF_Hqjc
        WHERE
        ihjyj IN ( 1, 2 ) AND bvisible = 1
        <if test="startTime != null">
            AND dIndate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dIndate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
        ) c
    </select>

    <!--产妇筛查数-->
    <select id="getMaternalScreeningTotal" resultType="long">
        SELECT  COUNT (1) AS total  FROM  yfyzqcqscsqb  WHERE datediff( month, dkdrq, #{date} ) = 0
    </select>

    <select id="getMaternalScreeningNumber" resultType="long">
        SELECT  COUNT (1) AS total  FROM  yfyzqcqscsqb  WHERE 1 = 1
        <if test="startTime != null">
            AND dkdrq >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dkdrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--高危孕产妇人数-->
    <select id="getHighriskMaternalTotal" resultType="long">
        SELECT  COUNT (1) AS total  FROM  yfgwys  WHERE datediff( month, dindate, #{date} ) = 0
    </select>

    <select id="getHighriskMaternalNumber" resultType="long">
        SELECT  COUNT (1) AS total  FROM  yfgwys  WHERE 1 = 1
        <if test="startTime != null">
            AND dindate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dindate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--孕产妇死亡人数-->
    <select id="getMaternalDeathTotal" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Yfsw  WHERE datediff( month, dSwsj, #{date} ) = 0
    </select>

    <select id="getMaternalDeathNumber" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Yfsw  WHERE 1 = 1
        <if test="startTime != null">
            AND dSwsj >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dSwsj <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--两癌筛查-宫颈癌筛查-->
    <select id="getCervicalCancerScreeningTotal" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Gjajcga_2015  WHERE datediff( month, dindate, #{date} ) = 0
    </select>

    <select id="getCervicalCancerScreeningNumber" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Gjajcga_2015  WHERE 1 = 1
        <if test="startTime != null">
            AND dindate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dindate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--两癌筛查-乳腺癌筛查-->
    <select id="getBreastCancerScreeningTotal" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Rxascdjb_2015  WHERE datediff( month, dindate, #{date} ) = 0
    </select>

    <select id="getBreastCancerScreeningNumber" resultType="long">
        SELECT  COUNT (1) AS total  FROM   Rxascdjb_2015  WHERE 1 = 1
        <if test="startTime != null">
            AND dindate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dindate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--母婴阻断-梅毒检测人数-->
    <select id="getSyphilisTestTotal" resultType="long">
        SELECT COALESCE (SUM(E6),0)  +  COALESCE (SUM(E7),0) AS total FROM Yfmdygmycbgzybb WHERE  iYear = DATEPART(yyyy, #{date}) AND iMonth =  DATEPART(m, #{date})
    </select>

    <select id="getSyphilisTestNumber" resultType="long">
        SELECT COALESCE (SUM(E6),0)  +  COALESCE (SUM(E7),0) AS total FROM Yfmdygmycbgzybb WHERE 1 = 1
        <if test="startTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) >= #{startTime}
        </if>
        <if test="endTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cjgdm = #{code}
        </if>
    </select>

    <!--母婴阻断-梅毒感染人数-->
    <select id="getSyphilisInfectionTotal" resultType="long">
        SELECT COALESCE (SUM(E9) ,0)  AS total  FROM  Yfmdygmycbgzybb WHERE  iYear = DATEPART(yyyy, #{date}) AND iMonth =  DATEPART(m, #{date})
    </select>


    <select id="getSyphilisInfectionNumber" resultType="long">
        SELECT COALESCE (SUM(E9) ,0)  AS total  FROM  Yfmdygmycbgzybb WHERE  1 = 1
        <if test="startTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) >= #{startTime}
        </if>
        <if test="endTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cjgdm = #{code}
        </if>
    </select>


    <!--母婴阻断-乙肝检测人数-->
    <select id="getHepatitisBtestTotal" resultType="long">
        SELECT  COALESCE (SUM(E11) ,0) + COALESCE (SUM(E12),0) AS  total  FROM Yfmdygmycbgzybb WHERE  iYear = DATEPART(yyyy, #{date}) AND iMonth =  DATEPART(m, #{date})
    </select>

    <select id="getHepatitisBtestNumber" resultType="long">
        SELECT  COALESCE (SUM(E11) ,0) + COALESCE (SUM(E12),0) AS  total  FROM Yfmdygmycbgzybb WHERE 1 = 1
        <if test="startTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) >= #{startTime}
        </if>
        <if test="endTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cjgdm = #{code}
        </if>
    </select>


    <!--母婴阻断-乙肝确定感染人次数-->
    <select id="getHepatitisBdeterminesInfectionTotal" resultType="long">
        SELECT COALESCE (SUM(E14)  ,0)  AS total  FROM  Yfmdygmycbgzybb WHERE  iYear = DATEPART(yyyy, #{date}) AND iMonth =  DATEPART(m, #{date})
    </select>

    <select id="getHepatitisBdeterminesInfectionNumber" resultType="long">
        SELECT COALESCE (SUM(E14)  ,0)  AS total  FROM  Yfmdygmycbgzybb WHERE  1 = 1
        <if test="startTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) >= #{startTime}
        </if>
        <if test="endTime != null">
            AND  CAST(CAST(iYear AS VARCHAR(4)) + '-' + CAST(iMonth AS VARCHAR(4)) + '-01' AS datetime) <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cjgdm = #{code}
        </if>
    </select>


    <!--妇女病筛查-->
    <select id="getWomenDiseaseScreeningTotal" resultType="long">
        SELECT   COUNT (1) AS total  FROM  Fnbjcxx   WHERE datediff( month, dindate, #{date} ) = 0
    </select>

    <select id="getWomenDiseaseScreeningNumber" resultType="long">
        SELECT   COUNT (1) AS total  FROM  Fnbjcxx   WHERE 1 = 1
        <if test="startTime != null">
            AND dindate >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dindate <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--产后访视-->
    <select id="getPostpartumVisitTotal" resultType="long">
        SELECT SUM(total) FROM(
        SELECT  COUNT(1) AS total FROM yfchfs WHERE   datediff( month, dFsrq, #{date} ) = 0
        UNION ALL
        SELECT  COUNT(1) AS total FROM yfxsefs WHERE   datediff( month, dFsrq, #{date} ) = 0
        ) c
    </select>

    <select id="getMaternalVisitNumber" resultType="long">
        SELECT COUNT(1) AS total FROM yfchfs WHERE 1 = 1
        <if test="startTime != null">
            AND dFsrq >= #{startTime}
        </if>
        <if test="endTime != null">
            AND dFsrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND cJcdwbh = #{code}
        </if>
    </select>

    <select id="getNewbornVisitNumber" resultType="long">
        SELECT COUNT(1) AS total FROM yfxsefs WHERE 1 = 1
        <if test="startTime != null">
            AND dFsrq >= #{startTime}
        </if>
        <if test="endTime != null">
            AND dFsrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND cJcdwbh = #{code}
        </if>
    </select>

    <!--孕产妇体检-->
    <select id="getMaternalCheckupData" resultType="com.paladin.qos.dynamic.model.exhibition.MaternalCheckup">
    SELECT
        ISNULL( a.cJcdwmc, b.cJcdwmc ) AS agencyName,
        ISNULL( a.cJcdwbh, b.cJcdwbh ) AS agencyNo,
        ISNULL( a.total, 0 ) AS firstExaminationTimes,
        ISNULL( b.total1, 0 ) AS cycleExaminationTimes
    FROM
        (
        SELECT
            cJcdwbh,
            COUNT ( 1 ) AS total,
            cJcdwmc
        FROM
            Yfcz
        WHERE
            cJcdwbh != '' AND  dCzrq >= #{startDate}
            <if test="endDate != null">
                AND  dCzrq <![CDATA[<= ]]> #{endDate}
            </if>
        GROUP BY
            cJcdwbh,
            cJcdwmc
        ) a
        FULL JOIN (
        SELECT
            cJcdwbh,
            COUNT ( 1 ) AS total1,
            cJcdwmc
        FROM
            yffz
        WHERE
            cJcdwbh != '' AND  dFzrq >= #{startDate}
            <if test="endDate != null">
                AND  dFzrq <![CDATA[<= ]]> #{endDate}
            </if>
        GROUP BY
            cJcdwbh,
            cJcdwmc
        ) b ON a.cJcdwbh = b.cJcdwbh
    ORDER BY
        agencyNo ASC
    </select>

    <!--孕产妇体检初检-->
    <select id="getFirstExaminationTimesNumber" resultType="long">
        SELECT  COUNT(1) AS total  FROM Yfcz WHERE cJcdwbh != ''
        <if test="startTime != null">
            AND dCzrq >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dCzrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>


    <!--孕产妇体检复检-->
    <select id="getCycleExaminationTimesNumber" resultType="long">
        SELECT COUNT(1) AS total FROM yffz WHERE 1 = 1
        <if test="startTime != null">
            AND dFzrq >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dFzrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>

    <!--叶酸发放人次数-->
    <select id="getNumberOfFolates" resultType="long">
        SELECT COUNT( 1 ) AS total
        FROM Csqyslqffdjb  WHERE  dDyclfsj >= #{ startTime }
        <if test="endTime != null">
            AND dDyclfsj <![CDATA[<= ]]>#{ endTime }
        </if>
    </select>

    <select id="getNumberOfFolatesNumber" resultType="long">
        SELECT COUNT( 1 ) AS total
        FROM Csqyslqffdjb  WHERE  1 = 1
        <if test="startTime != null">
            AND dDyclfsj >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dDyclfsj <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cFfdwdm = #{code}
        </if>
    </select>

    <!--叶酸发放瓶数-->
    <select id="getFolicAcidDispensingBottle" resultType="long">
        SELECT  COALESCE (SUM(iDycffsl ),0) AS total
        FROM Csqyslqffdjb  WHERE  dDyclfsj >= #{ startTime }
        <if test="endTime != null">
            AND dDyclfsj <![CDATA[<= ]]>#{ endTime }
        </if>
    </select>

    <select id="getFolicAcidDispensingBottleNumber" resultType="long">
        SELECT  COALESCE (SUM(iDycffsl ),0) AS total
        FROM Csqyslqffdjb  WHERE  1 = 1
        <if test="startTime != null">
            AND dDyclfsj >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dDyclfsj <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cFfdwdm = #{code}
        </if>
    </select>


    <!--孕妇建卡数-->
    <select id="getPregnantWomenBuildCardTotal" resultType="long">
        SELECT COUNT(1) AS total FROM YfMain WHERE  datediff(month,dJcrq,#{date})=0
    </select>


    <select id="getPregnantWomenBuildCardNumber" resultType="long">
        SELECT COUNT(1) AS total FROM YfMain WHERE 1 = 1
        <if test="startTime != null">
            AND dJcrq >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dJcrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>


    <!--早孕建卡数-->
    <select id="getEarlyPregnancyCardTotal" resultType="long">
        SELECT COUNT(1) AS total FROM YfMain WHERE iJcyz <![CDATA[< ]]>13  AND   datediff(month,dJcrq,#{date})=0
    </select>


    <select id="getEarlyPregnancyCardNumber" resultType="long">
        SELECT COUNT(1) AS total FROM YfMain WHERE iJcyz <![CDATA[< ]]>13
        <if test="startTime != null">
            AND dJcrq >=  #{startTime}
        </if>
        <if test="endTime != null">
            AND  dJcrq <![CDATA[<= ]]> #{endTime}
        </if>
        <if test="code != null">
            AND  cJcdwbh = #{code}
        </if>
    </select>


    <select id="getMaternalDataByOrg" resultType="com.paladin.qos.dynamic.model.exhibition.MaternalOrgData">
        SELECT COALESCE ( c.cJcdwmc, d.cJcdwmc, e.cJcdwmc ) AS agencyName,COALESCE ( c.cJcdwbh, d.cJcdwbh, e.cJcdwbh ) AS agencyNo,
        ISNULL( c.total, 0 ) AS zyjk,ISNULL( d.total, 0 ) AS yfjk,ISNULL( e.total, 0 ) AS yffs
        FROM
        (SELECT cJcdwbh,COUNT ( 1 ) AS total,cJcdwmc FROM YfMain WHERE cJcdwbh != '' AND dJcrq >= #{startDate}
         <if test="endDate != null">
        AND dJcrq <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY cJcdwbh,cJcdwmc ) c
        FULL JOIN
        (SELECT cJcdwbh,COUNT ( 1 ) AS total,cJcdwmc FROM YfMain WHERE iJcyz <![CDATA[< ]]> 13  AND  cJcdwbh != '' AND dJcrq >= #{startDate}
        <if test="endDate != null">
            AND dJcrq <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY cJcdwbh,cJcdwmc) d
        ON c.cJcdwbh = d.cJcdwbh
        FULL JOIN
        (SELECT ISNULL( a.cJcdwmc, b.cJcdwmc ) AS cJcdwmc,ISNULL( a.cJcdwbh, b.cJcdwbh ) AS cJcdwbh, ISNULL(a.total, 0) + ISNULL(b.total, 0) AS total FROM
        (SELECT  cJcdwbh,COUNT ( 1 ) AS total,cJcdwmc FROM yfchfs WHERE  cJcdwbh != '' AND dFsrq >= #{startDate}
        <if test="endDate != null">
            AND dFsrq <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY cJcdwbh,cJcdwmc ) a
        FULL JOIN
        (SELECT  cJcdwbh,COUNT ( 1 ) AS total,cJcdwmc FROM yfxsefs WHERE  cJcdwbh != '' AND dFsrq >= #{startDate}
        <if test="endDate != null">
            AND dFsrq <![CDATA[<= ]]> #{endDate}
        </if>
        GROUP BY cJcdwbh,cJcdwmc ) b
        ON a.cJcdwbh = b.cJcdwbh) e  ON d.cJcdwbh = e.cJcdwbh   ORDER BY agencyNo ASC
    </select>



</mapper>