<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paladin.qos.mapper.school.OrgSchoolMapper">

<select id="findSchool" resultType="com.paladin.qos.service.school.vo.OrgSchoolVO">
	SELECT o.id, school_year as schoolYear, n.`school_full_name`AS parentSchoolId,o.`address`,o.`affiliation`,o.`district`,o.`nature`,o.`create_Time` AS createTime FROM 
	org_school AS o 
	LEFT JOIN org_school_name AS n ON o.`parent_school_id`=n.`id` where 1=1 
	<if test="schoolName !=null and schoolName != '' ">
	 AND n.`school_full_name` LIKE CONCAT('%',#{schoolName},'%') 
	</if>
	<if test="affiliation !=null and affiliation != '' ">
	 AND affiliation = #{affiliation} 
	</if>
	<if test="nature !=null and nature != '' ">
	 AND nature = #{nature}
	</if>
	<if test="district !=null and district != '' ">
	 AND district = #{district}
	</if>
	ORDER BY o.create_time DESC
</select>

<select id="parentSchoolId" resultType="com.paladin.qos.service.school.vo.OrgSchoolVO">
	SELECT * FROM org_school WHERE parent_school_id = #{id}
</select>

<select id="schoolPersonnelCount" resultType="com.paladin.qos.service.school.vo.OrgSchoolPersonnelCountVO">
		SELECT
		s.`parent_school_id` AS parentSchoolId,
		n.`school_full_name` AS schoolFullName,
		s.total AS total
	FROM `org_school` AS s
	LEFT JOIN org_school_name AS n ON s.`parent_school_id` = n.`id`
	WHERE 1=1
	<if test="district != null and district !='' ">
		AND  s.`district` =#{district}
	</if>
	<if test="affiliation != null and affiliation != '' ">
		AND s.`affiliation` = #{affiliation}
	</if>
	<if test="nature != null and nature != '' ">
		AND s.`nature` = #{nature}
	</if>	
	ORDER BY s.total desc;
</select>

<select id="schoolDoctorCount" resultType="com.paladin.qos.service.school.vo.OrgSchoolDoctorCountVO">
	SELECT 
	  s.`parent_school_id` AS parentSchoolId,
	  n.`school_full_name` AS schoolFullName,
	  SUM(s.`school_doctor_part`) AS schoolDoctorPart,
	  SUM(s.`school_doctor_full`) AS schoolDoctorFull,
	  SUM(s.`health_teacher_part`) AS healthTeacherPart,
	  SUM(s.`health_teacher_full`) AS healthTeacherFull 
	FROM
	  `org_school` AS s 
	  LEFT JOIN org_school_name AS n 
	    ON s.`parent_school_id` = n.`id` 
	   WHERE 1 = 1 
	<if test="district != null and district !='' ">
		AND  s.`district` =#{district}
	</if>
	<if test="affiliation != null and affiliation != '' ">
		AND s.`affiliation` = #{affiliation}
	</if>
	<if test="nature != null and nature != '' ">
		AND s.`nature` = #{nature}
	</if>	
	GROUP BY s.`parent_school_id` 
</select>

</mapper>
