<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:include="/qos/header" />

<body>
<tt:constant enumcode="nature-type,subordination-type,region-type"/>
<section class="content-header">
    <h1>学校校医配备核查情况</h1>
</section>
<section class="content">
    <div class="box box-solid">
        <div class="box-body">
            <form id="searchbar" class="form-horizontal form-search">
            	<div class="form-group">
						<div class="col-md-2">
							<select id="district" name="district"class="form-control tonto-select-constant"th:attr="selectedvalue=${query?.district}"enumcode="region-type">
								<option value="">请选择区域</option>
							</select>
						</div>
						<div class="col-md-2">
							<select id="affiliation" name="affiliation"class="form-control tonto-select-constant"th:attr="selectedvalue=${query?.affiliation}"enumcode="subordination-type">
								<option value="">请选择隶属关系</option>
							</select>
						</div>
						<div class="col-md-2">
							<select id="nature" name="nature" class="form-control tonto-select-constant"th:attr="selectedvalue=${query?.nature}" enumcode="nature-type">
								<option value="">请选择性质</option>
							</select>
						</div>
						<div class="col-md-6">
                  <div class="pull-right">
                      <button type="button" style="width:100px" class="btn btn-primary tonto-btn-search" onclick="query()"><i class="fa fa-search"></i>查询</button>
                      <button type="button" style="width:100px" class="btn btn-default" onclick="$('#searchbar').resetSearch()"><i class="fa fa-repeat"></i>重置</button>
                  </div>
              </div>
             </div>
                <!-- 表单仅有一个text-input时回车会提交表单，这里添加一个无用的防止回车提交 -->
                <input type="text" style="display:none">
            </form>
            <input type="hidden" id="pageLimit" th:value="${query?.limit}" />
            <input type="hidden" id="pageOffset" th:value="${query?.offset}" />
        </div>
   </div>
	<div class="box box-solid" style="margin-top: 20px">
		<div id="result" class="box-body">
			<div class="row">
				<div class="col-sm-6">
					<div id="main" style="height: 500px"></div>
				</div>
				<div class="col-sm-6">
					<div id="main2" style="height: 500px"></div>
				</div>
			</div>

		</div>
	</div>
		<!-- <div class="box box-solid" style="margin-top: 20px">
		<div id="result" class="box-body">
			<div class="col-sm-12">
				<div id="main2" style="height: 300px"></div>
			</div>
		</div>
	</div> -->
</section>
<div th:include="/qos/footer" />
<script type="text/javascript">

	//<![CDATA[
	//图表自适应大小      
	window.addEventListener("resize", function() {
		schoolDoctor.resize();
		healthTeacher.resize();
	});
	
	function query() {
		myChart();
	}

	$(function() {
		myChart();
	});

	var schoolDoctor = echarts.init(document.getElementById('main'));
	var healthTeacher = echarts.init(document.getElementById('main2'));
	
	function myChart(){
		schoolDoctor.showLoading({
           text: '数据正在努力加载...',
           textStyle: { fontSize : 30 , color: '#444' },
           effectOption: {backgroundColor: 'rgba(0, 0, 0, 0)'}
       	}); 
	
		healthTeacher.showLoading({
           text: '数据正在努力加载...',
           textStyle: { fontSize : 30 , color: '#444' },
           effectOption: {backgroundColor: 'rgba(0, 0, 0, 0)'}
       	}); 
		
		var district = $("#district").val();
		var affiliation = $("#affiliation").val();
		var nature = $("#nature").val();
		$.post("/qos/org/school/statistic/doctor/count",{"district":district,"affiliation":affiliation,"nature":nature},function(res){
			debugger;
			var reslut = res.result;
			if(reslut == 0){
				showChartInfo(schoolDoctor,'暂无数据显示');
				showChartInfo2(healthTeacher,'暂无数据显示');
	             return false;
			}
			
			var schoolDoctorName = [];
			
			var schoolDoctorPartValue = [];
			var schoolDoctorFullValue = [];
			
			var healthTeacherPartValue = [];
			var healthTeacherFullValue = [];
			
			reslut.forEach(function(item){
				schoolDoctorName.push(item.schoolFullName);
				
				schoolDoctorPartValue.push({name:item.schoolFullName,value:item.schoolDoctorPart});
				schoolDoctorFullValue.push({name:item.schoolFullName,value:item.schoolDoctorFull});
				
				healthTeacherPartValue.push({name:item.schoolFullName,value:item.healthTeacherPart});
				healthTeacherFullValue.push({name:item.schoolFullName,value:item.healthTeacherFull});
			}) 
			
			schoolDoctor.hideLoading();
			healthTeacher.hideLoading();
			var	option1 = {
					 title: {
					        text: '校医配备情况图',
					    },
				    tooltip: {
				        trigger: 'axis',
				        axisPointer: {
				            type: 'shadow'
				        }
				    },
				    legend: {
				        data: ['校医(专职)', '校医(兼职)']
				    },
				    grid: {
				        left: '3%',
				        right: '4%',
				        bottom: '3%',
				        containLabel: true
				    },
				    xAxis: {
				        type: 'category',
				        axisLabel: {
  		                  interval:0,
  		                 rotate:-25//角度顺时针计算的
  		                } ,
				    	axisTick : {
							alignWithLabel : true
						},
				         data: schoolDoctorName
				    },
				    yAxis: {
				        type: 'value'
				    },
				    dataZoom: [
		   	    	            {
		   	    	                show: true,
		   	    	                start:0,
		   	    	                end: 35
		   	    	            },
		   	    	            {
		   	    	                type: 'inside',
		   	    	                start: 0,
		   	    	                end: 20
		   	    	            },
		   	    	            {
		   	    	                show: false,
		   	    	                yAxisIndex: 0,
		   	    	                filterMode: 'empty',
		   	    	                width: 0,
		   	    	                height: '80%',
		   	    	                showDataShadow: false,
		   	    	                left: '93%',
		   	    	                top:100
		   	    	            },
		   	    	            
		   	    	        ],
		   	    	     grid: {
		   	              bottom: '110px',
		   	          },
				    series: [
				        {
				            name: '校医(专职)',
				            type: 'bar',
				            barWidth : 25,
				            itemStyle:{
				                normal:{
				                    barBorderRadius:2,
				                }
				            },
				            data: schoolDoctorFullValue
				        },
				        {
				            name: '校医(兼职)',
				            type: 'bar',
				            barWidth : 25,
				            itemStyle:{
				                normal:{
				                    barBorderRadius:3,
				                }
				            },
				            data: schoolDoctorPartValue
				        }
				    ]
				};
		var	option2 = {
				title: {
			        text: '保健老师配备情况',
			    },
			    tooltip: {
			        trigger: 'axis',
			        axisPointer: {
			            type: 'shadow'
			        }
			    },
			    legend: {
			        data: ['保健老师(专职)', '保健老师(兼职)']
			    },
			    grid: {
			        left: '3%',
			        right: '4%',
			        bottom: '3%',
			        containLabel: true
			    },
			    xAxis: {
			        type: 'category',
			        axisLabel: {
  		                  interval:0,
  		                 rotate:-25//角度顺时针计算的
  		                } ,
			    axisTick : {
							alignWithLabel : true
						},
			         data: schoolDoctorName
			    },
			    yAxis: {
			        type: 'value'
			    },
			    dataZoom: [
	   	    	            {
	   	    	                show: true,
	   	    	                start: 0,
	   	    	                end: 35
	   	    	            },
	   	    	            {
	   	    	                type: 'inside',
	   	    	                start: 0,
	   	    	                end: 20
	   	    	            },
	   	    	            {
	   	    	                show: false,
	   	    	                yAxisIndex: 0,
	   	    	                filterMode: 'empty',
	   	    	                width: 0,
	   	    	                height: '80%',
	   	    	                showDataShadow: false,
	   	    	                left: '93%',
	   	    	                top:100
	   	    	            },
	   	    	            
	   	    	        ],
	   	    	     grid: {
	   	              bottom: '110px',
	   	          },
			    series: [
			        {
			            name: '保健老师(专职)',
			            type: 'bar',
			            barWidth : 25,
			            itemStyle:{
			                normal:{
			                    barBorderRadius:2,
			                }
			            },
			            data: healthTeacherFullValue
			        },
			        {
			            name: '保健老师(兼职)',
			            type: 'bar',
			            barWidth : 25,
			            itemStyle:{
			                normal:{
			                    barBorderRadius:2,
			                }
			            },
			            data: healthTeacherPartValue
			        }
			    ]
			};
		schoolDoctor.setOption(option1,true);
		healthTeacher.setOption(option2,true);
		})
	}
	
	//无数据展示
    var showChartInfo = function (schoolChart, infoStr) {
        var msgOption = {
            title: {
                show: true,
                textStyle:{
                    color:'grey',
                    fontSize:20
                },
                text: infoStr,
                left: 'center',
                top: 'center'
            },
            xAxis: {
                show: false
            },
            yAxis: {
                show: false
            },
            series: []
        };
        schoolDoctor.clear() ;
        schoolDoctor.hideLoading();
        schoolDoctor.setOption(msgOption)
    };
    
    var showChartInfo2 = function (healthTeacher, infoStr) {
        var msgOption = {
            title: {
                show: true,
                textStyle:{
                    color:'grey',
                    fontSize:20
                },
                text: infoStr,
                left: 'center',
                top: 'center'
            },
            xAxis: {
                show: false
            },
            yAxis: {
                show: false
            },
            series: []
        };
        healthTeacher.clear() ;
        healthTeacher.hideLoading();
        healthTeacher.setOption(msgOption)
    };
	
	
	//]]>
</script>
</body>

</html>