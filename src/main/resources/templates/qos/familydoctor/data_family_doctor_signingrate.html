<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:include="/qos/header" />
<link rel="stylesheet" href="/static/assets/bootstrap-table/extensions/fixed-columns/bootstrap-table-fixed-columns.css" />

<body>
    <tt:constant enumcode="data-unit-type" />
    </section>
    <section class="content-header">
        <h1>重点人群签约信息</h1>
    </section>
    <section class="content">
        <div class="box box-solid" style="height: 45px;margin-bottom: 10px">
            <div class="box-body no-pad-top">
                <form id="searchbar" class="form-horizontal form-search" style="margin-top: 5px;margin-left: 0;margin-right: 0">
                    <div class="form-group">
                        <div class="col-md-2">
                            <div class="input-group"><input name="year" id="year" placeholder="请输入年度" value="2018" autocomplete="off" type="text" class="form-control tonto-datepicker-year" lay-key="1" ></div>
                        </div>
                        <div class="col-md-10">
                            <div class="pull-right">
                                <button type="button" style="width:100px" class="btn btn-primary tonto-btn-search" onclick="refresh()"><i class="fa fa-search"></i>查询</button>
                                <button type="button" style="width:100px" class="btn btn-default" onclick="$('#searchbar').resetSearch()"><i class="fa fa-repeat"></i>重置</button>
                            </div>
                        </div>
                    </div>
                    <!-- 表单仅有一个text-input时回车会提交表单，这里添加一个无用的防止回车提交 -->
                    <input type="text" style="display:none">
                </form>
            </div>
        </div>
		<div class="row">
			<div class="col-md-7">
				<div class="row">
					<div class="col-md-12">
					<div class="box box-solid" style="margin-bottom: 5px">
						<div id="qylChart" class="box-body" style="height: 350px"></div>
					</div>
					</div>
					<div class="col-md-12">
						<div class="box box-solid">
							<div class="box-body">
								<table id="dataGrid"></table>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-5">
				<div class="row">
					<div class="row">
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="cjrqqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="gxyhzqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="box box-solid">
								<div id="tnbhzqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
					</div> 
					<div class="row">
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="ycfqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="zsetqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4" >
							<div class="box box-solid">
								<div id="lnrqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
					</div> 
					<div class="row">
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="yzjszahzqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="fjhhzqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
						<div class="col-md-4" >
							<div class="box box-solid">
								<div id="jbscgwryqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
					</div> 
					<div class="row">
						<div class="col-md-4" style="padding-right: 0">
							<div class="box box-solid">
								<div id="lxgbqylChart" class="box-body no-padding" style="height: 250px"></div>
							</div>
						</div>
					</div> 
				</div>
			</div>
		</div>
	</section>
    <div th:include="/qos/footer" />
	<script type="text/javascript" src="/static/js/chart.js"></script>
	<script src="/static/assets/bootstrap-table/extensions/fixed-columns/bootstrap-table-fixed-columns.js"></script>
    <script type="text/javascript">
  	//<![CDATA[
	//图表自适应大小      
	 window.addEventListener("resize", function() {
		qylChart.resize();
		cjrqqylChart.resize();
	    tnbhzqylChart.resize();
	    gxyhzqylChart.resize();
	    ycfqylChart.resize();
	    zsetqylChart.resize();
	    lnrqylChart.resize();
	    yzjszahzqylChart.resize();
	    fjhhzqylChart.resize();
	    jbscgwryqylChart.resize();
	    lxgbqylChart.resize();
	});
    
    
    var table, selectUnit, requestParams,dataVal;
    var charResult=[];
    $(function() {
        initTable(); 
    });
    
    function refresh() {
        table ? table.refresh() : buildTable1();
    }
    
    var currentElement;

    function initTable() {
        table = $.createTable("#dataGrid", {
            idField: "id",
            columns: [
                [
                    { title: "<span style='display: inline-block;width:150px;height: 64px;text-align: center;line-height: 64px'>医疗机构</span>", field: "unitName"},
                    { title: "残疾人群<br/>签约率", field: "evV21002",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21002==null){
                                return "0%"
                            }else{
                                return (row.evV21002/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "高血压患<br/>者签约率", field: "evV21003",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21003==null){
                                return "0%"
                            }else{
                                return (row.evV21003/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "糖尿病患<br/>者签约率", field: "evV21004",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21004==null){
                                return "0%"
                            }else{
                                return (row.evV21004/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "孕产妇<br/>签约率", field: "evV21005" ,
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21005==null){
                                return "0%"
                            }else{
                                return (row.evV21005/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "0-6周岁儿<br/>童签约率", field: "evV21006" ,
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21006==null){
                                return "0%"
                            }else{
                                return (row.evV21006/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "65周岁及以上<br/>老年人签约率", field: "evV21007",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21007==null){
                                return "0%"
                            }else{
                                return (row.evV21007/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "严重精神<br/>障碍患者签约率", field: "evV21008",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21008==null){
                                return "0%"
                            }else{
                                return (row.evV21008/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "肺结核<br/>患者签约率", field: "evV21009",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21009==null){
                                return "0%"
                            }else{
                                return (row.evV21009/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "疾病筛查<br/>高危人员签约率", field: "evV21010",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21010==null){
                                return "0%"
                            }else{
                                return (row.evV21010/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    },
                    { title: "离休干部<br/>签约率", field: "evV21011",
                        formatter: function(value, row, index) {
                            if(row.evV21001==0||row.evV21011==null){
                                return "0%"
                            }else{
                                return (row.evV21011/row.evV21001*100).toFixed(2) * 1+"%";
                            }
                        }
                    }
                ]
            ],
			url: '/qos/sign/get/group/data',
            pagination: false,
            fixedColumns: true,
            fixedNumber: 1,
            searchbar: '#searchbar',
            clickToSelect: true,
			onClickRow: function(row, tr) {
				$("#dataGrid").find(".selected").removeClass('selected');
				$(tr).addClass('selected');
				unitSelected(row);
			},
			queryParams: function(params) {
				params.eventIds = 'V21001,V21002,V21003,V21004,V21005,V21006,V21007,V21008,V21009,V21010,V21011';
                requestParams = params;
                return params;
			},
			responseHandler: function(response) {

				if (!response) {
					return null;
				}

				var data = {};

				convertCount2TableData(response, 'V21001', data);
				convertCount2TableData(response, 'V21002', data);
				convertCount2TableData(response, 'V21003', data);
				convertCount2TableData(response, 'V21004', data);
				convertCount2TableData(response, 'V21005', data);
				convertCount2TableData(response, 'V21006', data);
				convertCount2TableData(response, 'V21007', data);
                convertCount2TableData(response, 'V21008', data);
                convertCount2TableData(response, 'V21009', data);
                convertCount2TableData(response, 'V21010', data);
                convertCount2TableData(response, 'V21011', data);
                
				var result = [];
				for (var o in data) {
					result.push(data[o]);
				}
				charResult = result;
				qylChartMethod(response);

				 //dataVal = data|| [];
				cjrqqylChartMethod();
				 gxyhzqylChartMethod();
				tnbhzqylChartMethod();
				ycfqylChartMethod();
				zsetqylChartMethod();
				lnrqylChartMethod();
				yzjszahzqylChartMethod();
				fjhhzqylChartMethod();
				jbscgwryqylChartMethod();
				lxgbqylChartMethod(); 
				return result;
			}
        });
    }

    function unitSelected(row) {
		selectUnit = row.unitId;
		cjrqqylChartMethod();
		gxyhzqylChartMethod();
		tnbhzqylChartMethod();
		ycfqylChartMethod();
		zsetqylChartMethod();
		lnrqylChartMethod();
		yzjszahzqylChartMethod();
		fjhhzqylChartMethod();
		jbscgwryqylChartMethod();
		lxgbqylChartMethod();
	}
    function convertCount2TableData(originData, eventId, data) {
        var eventData = originData[eventId],
            fieldName = 'ev' + eventId,
            total = 0;

        eventData && eventData.forEach(function(item) {
            var id = item.unitId;
            unitData = data[id];
            if (!unitData) {
                unitData = {
                    unitId: id,
                    unitName: item.unitName
                };
                data[id] = unitData;
            }
            unitData[fieldName] = item.count;
            total += item.count;
        });

        var totalData = data['total'];
        if (!totalData) {
            totalData = {
                unitId: 'total',
                unitName: '合计',
            }
            data['total'] = totalData;
        }
        totalData[fieldName] = total;
    }
    function convertCountTableData(originData, eventId, data) {
        var eventData = originData[eventId];
        eventData && eventData.forEach(function(item) {
            var id = item.unitId;
            unitData = data[id];
            if (!unitData) {
                unitData = {
                    unitId: id,
                    unitName: item.unitName,
                };
                data[id] = unitData;
            }
            unitData['total'+eventId]=item.count;
        });

    }

	function getRate(item, fixed) {
		var a = item.eventNum,
				b = item.totalNum,
				c = 0;
		if (a && b) {
			c = a / b * 100;
		}
		return c.toFixed(fixed || 2) + '%';
	}

	function getRateNum(item, fixed) {
		var a = item.eventNum,
				b = item.totalNum,
				c = 0;
		if (a && b) {
			c = a / b * 100;
		}
		return c.toFixed(fixed);
	}

	function convertUnit1ChartData(data, eventId, isRate) {
		var edata = data[eventId],
				max = 0,
				unit = [],
				values = [];
		edata && edata.forEach(function(item) {
					var r =  item.count;
					max = Math.max(r, max);
					values.push(r);
					unit.push(item.unitName);
			
		});
		return {
			max: max,
			unit: unit,
			values: values
		}
	}
	function convertUnitChartData(data, eventId, isRate) {
		var total = data['V21001'];
		var edata = data[eventId],
				max = 0,
				unit = [],
				values = [];
		edata && edata.forEach(function(item) {
			for(o in total){
				if(total[o].unit == item.unit){
					var r =  (item.count/total[o].count*100).toFixed(2);
					max = Math.max(r, max);
					values.push(r);
					unit.push(item.unitName);	
				}
				
			}
					
			
		});
		return {
			max: max,
			unit: unit,
			values: values
		}
	}

	var dataLegend = ['残疾人群签约率', '高血压患者签约率','糖尿病患者签约率', '孕产妇签约率','0-6周岁儿童签约率', '65周岁及以上老年人签约率', '严重精神障碍患者签约率', '肺结核患者签约率','疾病筛查高危人员签约率','离休干部签约率'];
    
    var qylChart= echarts.init(document.getElementById('qylChart'));
    function qylChartMethod(data){

		var ev21001 = convertUnit1ChartData(data, 'V21001', true);
		var ev21002 = convertUnitChartData(data, 'V21002', true);
		var ev21003 = convertUnitChartData(data, 'V21003', true);
		var ev21004 = convertUnitChartData(data, 'V21004', true);
		var ev21005 = convertUnitChartData(data, 'V21005', true);
		var ev21006 = convertUnitChartData(data, 'V21006', true);
		var ev21007 = convertUnitChartData(data, 'V21007', true);
		var ev21008 = convertUnitChartData(data, 'V21008', true);
		var ev21009 = convertUnitChartData(data, 'V21009', true);
		var ev21010 = convertUnitChartData(data, 'V21010', true);
		var ev21011 = convertUnitChartData(data, 'V21011', true);

		let orgData = ev21001.unit;
        var isShowScroll = false; // 是否显示滚动条，默认false不显示
        var dataZoom_end; // 显示百分之多少的数据量，默认全部
        if (orgData.length > 5) {
            dataZoom_end = 100 / (orgData.length / 10);
            isShowScroll = true;
        } else {
            dataZoom_end = 100;
        }
    		    var	option = {
   				    tooltip: {
						trigger: 'axis',
						formatter: function(params, ticket, callback) {
							var html = params[0].axisValueLabel + '：';
							for (var i = 0; i < params.length; i++) {
								var param = params[i];
								html += '<br/>' + param.marker + param.seriesName + '：' + param.value + '%';
							}
							return html;
						},
						axisPointer: {
							type: 'shadow'
						}
   				    },
   				    legend: {
   				        data: dataLegend,
   				        type: 'scroll',
   				        orient: 'horizontal',
   				        bottom: 10,
   				    },
   				    grid: {
   				        left: '0%',
   				        right: '0%',
   				        top: '5%',
   				        containLabel: true
   				    },
                    dataZoom: [{
                        start: 0, //默认为0
                        end: dataZoom_end,
                        type: 'slider',
                        show: isShowScroll,
                        xAxisIndex: [0],
                        handleSize: 8, //滑动条的 左右2个滑动条的大小
                        height: 10, //组件高度
                        left: "center", //左边的距离
                        bottom: 1,
                        handleColor: '#ddd', //h滑动图标的颜色
                        handleStyle: {
                            borderColor: "#cacaca",
                            borderWidth: "1",
                            shadowBlur: 2,
                            background: "#ddd",
                            shadowColor: "#ddd",
                        },
                        fillerColor: new echarts.graphic.LinearGradient(1,
                            0, 0, 0, [{
                                //给颜色设置渐变色 前面4个参数，给第一个设置1，第四个设置0 ，就是水平渐变
                                //给第一个设置0，第四个设置1，就是垂直渐变
                                offset: 0,
                                color: '#1eb5e5'
                            }, {
                                offset: 1,
                                color: '#5ccbb1'
                            }]),
                        zoomLock: true, //是否锁定选择区域（或叫做数据窗口）的大小。如果设置为 true 则锁定选择区域的大小，也就是说，只能平移，不能缩放。
                        backgroundColor: '#ddd', //两边未选中的滑动条区域的颜色
                        showDataShadow: false, //是否显示数据阴影 默认auto
                        showDetail: false, //即拖拽时候是否显示详细数值信息 默认true
                        handleIcon: 'M-292,322.2c-3.2,0-6.4-0.6-9.3-1.9c-2.9-1.2-5.4-2.9-7.6-5.1s-3.9-4.8-5.1-7.6c-1.3-3-1.9-6.1-1.9-9.3c0-3.2,0.6-6.4,1.9-9.3c1.2-2.9,2.9-5.4,5.1-7.6s4.8-3.9,7.6-5.1c3-1.3,6.1-1.9,9.3-1.9c3.2,0,6.4,0.6,9.3,1.9c2.9,1.2,5.4,2.9,7.6,5.1s3.9,4.8,5.1,7.6c1.3,3,1.9,6.1,1.9,9.3c0,3.2-0.6,6.4-1.9,9.3c-1.2,2.9-2.9,5.4-5.1,7.6s-4.8,3.9-7.6,5.1C-285.6,321.5-288.8,322.2-292,322.2z',
                        filterMode: 'filter'
                    },
                        //下面这个属性是里面拖到
                        {
                            type: 'inside',
                            show: true,
                            xAxisIndex: [0],
                            start: 0, //默认为1
                            end: 50
                        }
                    ],
   				    xAxis: {
   				        type: 'category',
   				        axisLabel: {
    		                interval:0,
    		                rotate:0,//角度顺时针计算的
    		                formatter: function(value) {
    	                        var reg = new RegExp('社区卫生服务中心', "g");
    	                      return value.replace(reg, '');
    	                    }
    		                } ,
   				    	axisTick : {
   							alignWithLabel : true
   						},
   				         data: orgData
   				    },
   				    yAxis: {
   				        type: 'value',
   				        axisLabel: {
   		                    show:true,
   		                    formatter: '{value}%',//给Y轴数值添加百分号
   		                }
   				    },
    		    series : [
					{
					    name: '残疾人群签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#4a72c9'
					       }
					    },
					    data: ev21002.values
					},
					{
					    name: '高血压患者签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#6071c6'
					       }
					    },
					    data: ev21003.values
					},
					{
					    name: '糖尿病患者签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#78a9f2'
					       }
					    },
					    data: ev21004.values
					},
					{
					    name: '孕产妇签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#a3ccf8'
					       }
					    },
					    data: ev21005.values
					},
					{
					    name: '0-6周岁儿童签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#47b8e2'
					       }
					    },
					    data: ev21006.values
					},
					{
					    name: '65周岁及以上老年人签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#6087bf'
					       }
					    },
					    data: ev21007.values
					},
					{
					    name: '严重精神障碍患者签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#4a72c9'
					       }
					    },
					    data: ev21008.values
					},
					{
					    name: '肺结核患者签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#6071c6'
					       }
					    },
					    data: ev21009.values
					},
					{
					    name: '疾病筛查高危人员签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#4b87e0'
					       }
					    },
					    data: ev21010.values
					},
					{
					    name: '离休干部签约率',
					    type: 'bar',
					    barWidth : 4,
					    itemStyle : {
					       normal : {
							color: '#8eb4ec'
					       }
					    },
					    data: ev21011.values
					}
    		    ]
    		};
    	qylChart.setOption(option,true);
    }
   
    var cjrqqylChart = echarts.init(document.getElementById('cjrqqylChart'));
    function cjrqqylChartMethod(){
		let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21002!=null&&it.evV21001!=0){
        	var rate=(it.evV21002/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'残疾人群签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
                        width: 30,
                        height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
                        fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'残疾人群签约率',
                        type:'pie',
                        radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'残疾人群签约率'
                            }
                        ]
                    }
                ]
            };
    	cjrqqylChart.setOption(option,true);
    }

    var gxyhzqylChart = echarts.init(document.getElementById('gxyhzqylChart'));
    function gxyhzqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21003!=null&&it.evV21001!=0){
        	var rate=(it.evV21003/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage +'\n'+'高血压患者'+'\n'+'签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'高血压患者签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'高血压患者签约率'
                            }
                        ]
                    }
                ]
            };
    	gxyhzqylChart.setOption(option,true);
    } 
 
    var tnbhzqylChart = echarts.init(document.getElementById('tnbhzqylChart'));
    function tnbhzqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21004!=null&&it.evV21001!=0){
        	var rate=(it.evV21004/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage +'\n'+'糖尿病患者'+'\n'+'签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'糖尿病患者签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'糖尿病患者签约率'
                            }
                        ]
                    }
                ]
            };
    	tnbhzqylChart.setOption(option,true);
    } 
    
    var ycfqylChart = echarts.init(document.getElementById('ycfqylChart'));
    function ycfqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21005!=null&&it.evV21001!=0){
        	var rate=(it.evV21005/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'孕产妇签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'孕产妇签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'孕产妇签约率'
                            }
                        ]
                    }
                ]
            };
    	ycfqylChart.setOption(option,true);
    } 
    
    var zsetqylChart = echarts.init(document.getElementById('zsetqylChart'));
    function zsetqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21006!=null&&it.evV21001!=0){
        	var rate=(it.evV21006/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'0~6周岁儿童'+'\n'+'签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'0~6周岁儿童签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'0~6周岁儿童签约率'
                            }
                        ]
                    }
                ]
            };
    	zsetqylChart.setOption(option,true);
    } 
    
    var lnrqylChart = echarts.init(document.getElementById('lnrqylChart'));
    function lnrqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21007!=null&&it.evV21001!=0){
        	var rate=(it.evV21007/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b}: {c} ({d}%)"
                },
                color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'65周岁及以上'+'\n'+'老年人签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'65周岁及以上老年人签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'65周岁及以上老年人签约率'
                            }
                        ]
                    }
                ]
            };
    	lnrqylChart.setOption(option,true);
    } 
    
    var yzjszahzqylChart = echarts.init(document.getElementById('yzjszahzqylChart'));
    function yzjszahzqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21008!=null&&it.evV21001!=0){
        	var rate=(it.evV21008/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b}: {c} ({d}%)"
                },
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'严重精神障碍'+'\n'+'患者签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'严重精神障碍患者签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'严重精神障碍患者签约率'
                            }
                        ]
                    }
                ]
            };
    	yzjszahzqylChart.setOption(option,true);
    } 

    var fjhhzqylChart = echarts.init(document.getElementById('fjhhzqylChart'));
    function fjhhzqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21009!=null&&it.evV21001!=0){
        	var rate=(it.evV21009/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b}: {c} ({d}%)"
                },
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'肺结核患者'+'\n'+'签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'肺结核患者签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'肺结核患者签约率'
                            }
                        ]
                    }
                ]
            };
    	fjhhzqylChart.setOption(option,true);
    } 
    
    var jbscgwryqylChart = echarts.init(document.getElementById('jbscgwryqylChart'));
    function jbscgwryqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21010!=null&&it.evV21001!=0){
        	var rate=(it.evV21010/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'疾病筛查高危'+'\n'+'人员签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'疾病筛查高危人员签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'疾病筛查高危人员签约率'
                            }
                        ]
                    }
                ]
            };
    	jbscgwryqylChart.setOption(option,true);
    } 
    
    var lxgbqylChart = echarts.init(document.getElementById('lxgbqylChart'));
    function lxgbqylChartMethod(){
    	let unitId = selectUnit || 'total';
        var total=[];
        for (var i = 0; i < charResult.length; i++) {
            if (unitId=='total'){
                total.push(charResult[i])
            }else{
                if (charResult[i].unitName==unitId){
                    total.push(charResult[i]);
                }
            }
        }
        var it=total[total.length - 1];
        if(it.evV21011!=null&&it.evV21001!=0){
        	var rate=(it.evV21011/it.evV21001*100).toFixed(2)+ '%';
            
        }else{
        	var rate = "0%";
        }
         
        rate=rate.replace("%","")*1;
        remainRate=(100-rate).toFixed(2);
        
        var pieMessage;
        pieMessage=rate+"%";
    	var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b}: {c} ({d}%)"
                },
				color: ['#999999','#3398DB'],
                graphic: [{ //环形图中间添加文字
                    type: 'text', //通过不同top值可以设置上下显示
                    left: 'center',
                    top: '45%',
                    style: {
                        text: pieMessage+'\n'+'离休干部签约率',
                        textAlign: 'center',
                        fill: 'black', //文字的颜色
						width: 30,
						height: 40,
						fontSize: '100%',
						fontWeight : 'bolder',
						fontFamily: "Microsoft YaHei"
                    }
                }],
                series: [
                    {
                        name:'离休干部签约率',
                        type:'pie',
						radius: ['70%', '95%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },

                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:[
							{
								value:remainRate,
								name:'',
								hoverAnimation:false,
								tooltip:{
									show:false,
								},
							},
							{
                                value:rate,
                                name:'离休干部签约率'
                            }
                        ]
                    }
                ]
            };
    	lxgbqylChart.setOption(option,true);
    } 
  	//]]>
    </script>
</body>

</html>